(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[808],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(s,".").concat(m)]||d[m]||u[m]||r;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7871:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return s},toc:function(){return p},default:function(){return u}});var a=n(2122),o=n(9756),r=(n(7294),n(3905)),i=["components"],l={title:"\ud83d\ude80 Deploy on Azure",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Deploy on Azure",description:"Instructions to deploy the notification service for Moodle on Azure",keywords:["moodle","notification","service","deploy","azure"]},s={unversionedId:"getting-started/deploy-on-azure",id:"getting-started/deploy-on-azure",isDocsHomePage:!1,title:"\ud83d\ude80 Deploy on Azure",description:"Instructions to deploy the notification service for Moodle on Azure",source:"@site/moodlebot/getting-started/deploy-on-azure.md",sourceDirName:"getting-started",slug:"/getting-started/deploy-on-azure",permalink:"/moodle-notification-service/2.0.0/getting-started/deploy-on-azure",editUrl:"https://github.com/tjarbo/documentation/tree/master/docs/moodlebot/moodlebot/getting-started/deploy-on-azure.md",version:"current",sidebar_label:"Deploy on Azure",frontMatter:{title:"\ud83d\ude80 Deploy on Azure",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Deploy on Azure",description:"Instructions to deploy the notification service for Moodle on Azure",keywords:["moodle","notification","service","deploy","azure"]},sidebar:"tutorialSidebar",previous:{title:"\ud83d\ude80 Deploy to Heroku",permalink:"/moodle-notification-service/2.0.0/getting-started/deploy-to-heroku"},next:{title:"configure-via-env",permalink:"/moodle-notification-service/2.0.0/advanced-guides/configure-via-env"}},p=[{value:"\ud83d\udda5\ufe0f Deploy as VM",id:"\ufe0f-deploy-as-vm",children:[]},{value:"\ud83c\udd99 Deploy as App Service",id:"-deploy-as-app-service",children:[]},{value:"\u2705 Yeah!",id:"-yeah",children:[]}],c={toc:p};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This article will help you to deploy your notification service to Azure. You can choose between the standard approach using a ",(0,r.kt)("em",{parentName:"p"},"VM which is managed by yourself")," or to use an ",(0,r.kt)("em",{parentName:"p"},"App Service")," which manages everything for you. But this comes with a higher price.\nPlease follow the instructions step by step."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Azure provides free credits for students. More information ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/en-us/free/students/"},"here")))),(0,r.kt)("h3",{id:"\ufe0f-deploy-as-vm"},"\ud83d\udda5\ufe0f Deploy as VM"),(0,r.kt)("p",null,"To deploy the notification service in VM on Azure, make sure that you have ..."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"an account on ",(0,r.kt)("a",{parentName:"li",href:"https://portal.azure.com"},"Azure")," and an active subscription."),(0,r.kt)("li",{parentName:"ol"},"access to ",(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/azure/cloud-shell/quickstart"},"Azure Cloud Shell"))),(0,r.kt)("p",null,"Afterwards I refer to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/virtual-machines/linux/quick-create-portal"},"this article")," by Microsoft docs to setup a new Linux VM to avoid outdated information.\nYou can stop as soon as you have shell access to your VM via SSH; You do not need to install a web server."),(0,r.kt)("p",null,"Then you can continue at the beginning of ",(0,r.kt)("a",{parentName:"p",href:"/moodle-notification-service/2.0.0/getting-started/deploy-with-docker"},"Deploy-with-Docker"),"."),(0,r.kt)("h3",{id:"-deploy-as-app-service"},"\ud83c\udd99 Deploy as App Service"),(0,r.kt)("p",null,"To deploy the notification service as App Service make sure that you have ..."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"an account on ",(0,r.kt)("a",{parentName:"li",href:"https://portal.azure.com"},"Azure")," and an active subscription."),(0,r.kt)("li",{parentName:"ol"},"access to ",(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/azure/cloud-shell/quickstart"},"Azure Cloud Shell")),(0,r.kt)("li",{parentName:"ol"},"a ",(0,r.kt)("inlineCode",{parentName:"li"},".env")," file from ",(0,r.kt)("a",{parentName:"li",href:"setup-preparation.md"},"these steps")),(0,r.kt)("li",{parentName:"ol"},"access to a MongoDB database like from ",(0,r.kt)("a",{parentName:"li",href:"../preparation/use-mongodb-atlas.md"},"MongoDB Atlas"))),(0,r.kt)("p",null,"Open the ",(0,r.kt)("em",{parentName:"p"},"Azure Cloud Shell")," and you are ready"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Docker has changed its rate limits on unauthenticated pull requests from Docker Hub. This can cause issues while using Docker Hub and Azure App Services. More information and a solution you can find ",(0,r.kt)("a",{parentName:"p",href:"https://azure.github.io/AppService/2020/10/15/Docker-Hub-authenticated-pulls-on-App-Service.html"},"here"),"."))),(0,r.kt)("h4",{id:"1-get-your-wanted-location-and-create-new-resource-group"},"1. Get your wanted location and create new Resource Group"),(0,r.kt)("p",null,"If you not already have, set your default subscription."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-azurecli"},"az account set --subscription XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n")),(0,r.kt)("p",null,"Receive a list of all available locations with ",(0,r.kt)("inlineCode",{parentName:"p"},"az account list-locations")," and choose your favorite location. Then use the following command to create a new resource group, replace ",(0,r.kt)("inlineCode",{parentName:"p"},"westus")," with you selected location."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-azurecli"},"az group create --name notification-service-rg --location westus\naz config set defaults.group=notification-service-rg defaults.location=westus\n")),(0,r.kt)("p",null,"The second command is used to set the default resource group and location. Please keep in mind that you need to changes these values if you are using the Azure CLI also for other projects."),(0,r.kt)("h4",{id:"2-create-an-app-service"},"2. Create an App Service"),(0,r.kt)("p",null,"Choose a cool app name for the notification service. The name will be used for the final url ",(0,r.kt)("inlineCode",{parentName:"p"},"https://[app name].azurewebsites.net"),". Use this URL for the ",(0,r.kt)("inlineCode",{parentName:"p"},"RP_ORIGIN")," in your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," (e.g ",(0,r.kt)("inlineCode",{parentName:"p"},"RP_ORIGIN=https://notification-service.azurewebsites.net"),"). Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"app-name")," in every following command with your chosen name."),(0,r.kt)("p",null,"To create the app service, use the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-azurecli"},"az webapp config container set --name app-name --docker-custom-image-name tjarbo/notification-service:latest\n")),(0,r.kt)("p",null,"Now it is time to apply you ",(0,r.kt)("inlineCode",{parentName:"p"},".env"),". If your file is located in your working directory in your ",(0,r.kt)("em",{parentName:"p"},"Azure Cloud Shell")," you can execute this command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-azurecli"},"az webapp config appsettings set -n app-name --settings @.env\n")),(0,r.kt)("p",null,"If not, it becomes a bit more work, as you need to apply each line of ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," to the following command (KEY=value pairs are separated by a whitespace)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-azurecli"},"az webapp config appsettings set -n app-name --settings MONGO_HOST=mongodb://mongo:27017/fmdb MOODLE_BASE_URL=https://moodle...\n")),(0,r.kt)("p",null,"Finally validate everything with ",(0,r.kt)("inlineCode",{parentName:"p"},"az webapp config appsettings list -n app-name")),(0,r.kt)("h3",{id:"-yeah"},"\u2705 Yeah!"))}u.isMDXComponent=!0}}]);